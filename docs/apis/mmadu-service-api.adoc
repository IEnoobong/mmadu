= Mmadu Service Api
Oyudo Gerald <gerald.oyudo@gmail.com>
v0.0.1, 2018-09-04
:toc: left
:sectnums:
:showtitle:
:page-navtitle: Mmadu Service Api Documentation
:page-excerpt: Mmadu
:page-root: ../
:imagesdir: {page-root}/images
:permalink: /:title/
:page-layout: api
:snippets: snippets

== Introduction

Mmadu user service exposes API's to help you interact with the user service.

== API Features

=== Security

If token security is enabled, you will need a token to access the api.

Simply set the domain-auth-token header to the value of the token. For more information on tokens, see token management.

==== Permissions

Some tokens have admin permissions, while others have domain permissions. Admin tokens can access all parts of the API,
while domain tokens can only access parts of the api that returns resources pertaining to the domain.


=== Authentication

Using the rest api, you can authenticate users given a username and
password.

A post request authenticates a user on a domain.

==== Request Fields

include::{snippets}/authentication-documentation/authentication/1/request-fields.adoc[]

Example:

include::{snippets}/authentication-documentation/authentication/1/http-request.adoc[]

==== Response Fields

This API returns a JSON response with the following fields:

include::{snippets}/authentication-documentation/authentication/1/response-fields.adoc[]

Example:

include::{snippets}/authentication-documentation/authentication/1/http-response.adoc[]

=== User Management

With Mmadu user service, you can manage your users across any domain.

==== Domains

A client application references users in one domain. A domain is referenced by a domain id. Applications
can share the same user base by using the same domain id.

===== Security

If token security is enabled, the domain api can be accessed with the admin token.

Token security is enabled by default. To disable, set the environment property `mmadu.domain.api-security-enabled`
to `false`.

===== Creating A domain

A POST request will create a domain

====== Request Fields

include::{snippets}/domain-management-documentation/create-a-domain/1/request-fields.adoc[]

Example:

include::{snippets}/domain-management-documentation/create-a-domain/1/http-request.adoc[]

====== Response Fields

This API returns a HTTP 201 CREATED response with an empty body.

===== Getting a domain with an ID


A GET request will get a domain with an ID.

====== Path Parameters

include::{snippets}/domain-management-documentation/get-a-domain-by-id/1/path-parameters.adoc[]

Example:

include::{snippets}/domain-management-documentation/get-a-domain-by-id/1/http-request.adoc[]


====== Response Fields

This API returns an AppDomain with these fields:

include::{snippets}/domain-management-documentation/get-a-domain-by-id/1/response-fields.adoc[]

Example:

include::{snippets}/domain-management-documentation/get-a-domain-by-id/1/http-response.adoc[]

===== Getting All Domains

A GET request will get all domains.

Example:

include::{snippets}/domain-management-documentation/getting-all-domains/1/http-request.adoc[]


====== Response Fields

This API returns a list of all domains with these fields:

include::{snippets}/domain-management-documentation/getting-all-domains/1/response-fields.adoc[]

Example:

include::{snippets}/domain-management-documentation/getting-all-domains/1/http-response.adoc[]

===== Updating A Domain with an ID

A PATCH request will update a domain with an ID.

====== Path Parameters

include::{snippets}/domain-management-documentation/updating-a-domain/1/path-parameters.adoc[]

Example:

include::{snippets}/domain-management-documentation/updating-a-domain/1/http-request.adoc[]


====== Response Fields

This API returns a HTTP 204 NO CONTENT response.

Example:

include::{snippets}/domain-management-documentation/updating-a-domain/1/http-response.adoc[]

===== Removing A Domain

A DELETE request will remove a domain with an ID.

====== Path Parameters

include::{snippets}/domain-management-documentation/deleting-a-domain-by-id/1/path-parameters.adoc[]

Example:

include::{snippets}/domain-management-documentation/deleting-a-domain-by-id/1/http-request.adoc[]

====== Response Fields

This API returns a HTTP 204 NO CONTENT response.

Example:

include::{snippets}/domain-management-documentation/deleting-a-domain-by-id/1/http-response.adoc[]

===== Configuring Domains

====== Default Domain Configuration

The default domain configuration is automatically adopted when no configuration exists for a domain.
Every domain can have at most one domain configuration.

====== Accessing the Default Domain Configuration

The default domain configuration has a domain configuration id of 0, and a blank authenticationApiToken. This means
that you can access the domain with any token value.

A GET request will get the default domain configuration.

Request

include::{snippets}/domain-configuration-documentation/get-default-domain-configuration/1/http-request.adoc[]

Response

include::{snippets}/domain-configuration-documentation/get-default-domain-configuration/1/http-response.adoc[]

===== Creating A Configuration for a domain

The domain will switch to its own configuration and cease to utilize the default configuration once a configuration
is created for the domain.

IMPORTANT: You cannot create more than one domain configuration object for a domain.

A POST request will create a domain configuration.

====== Request Fields

include::{snippets}/domain-configuration-documentation/create-a-domain-configuration/1/request-fields.adoc[]

Example:

include::{snippets}/domain-configuration-documentation/create-a-domain-configuration/1/http-request.adoc[]


====== Response Fields

This API returns a HTTP 201 CREATED response with an empty body.

===== Getting A Domain Configuration with an ID

A GET request will get a domain configuration with a domain configuration ID.

====== Path Parameters

include::{snippets}/domain-configuration-documentation/get-domain-configuration-by-i-d/1/path-parameters.adoc[]

Example:

include::{snippets}/domain-configuration-documentation/get-domain-configuration-by-i-d/1/http-request.adoc[]


====== Response Fields

This API returns a domain configuration with these fields:

include::{snippets}/domain-configuration-documentation/get-domain-configuration-by-i-d/1/response-fields.adoc[]

Example:

include::{snippets}/domain-configuration-documentation/get-domain-configuration-by-i-d/1/http-response.adoc[]

===== Getting A Domain Configuration for a Domain

A GET request will get a domain configuration for a domain.

====== Request Parameters

include::{snippets}/domain-configuration-documentation/get-domain-configuration-by-domain-i-d/1/request-parameters.adoc[]

Example:

include::{snippets}/domain-configuration-documentation/get-domain-configuration-by-domain-i-d/1/http-request.adoc[]


====== Response Fields

This API returns a domain configuration with these fields:

include::{snippets}/domain-configuration-documentation/get-domain-configuration-by-domain-i-d/1/response-fields.adoc[]

Example:

include::{snippets}/domain-configuration-documentation/get-domain-configuration-by-domain-i-d/1/http-response.adoc[]

===== Removing A Domain Configuration by ID

A DELETE request will remove a domain configuration with an ID. Removal will make the domain use the default configuration.

WARNING: Do not remove the default configuration as this will cause unexpected behaviour.

====== Path Parameters

include::{snippets}/domain-configuration-documentation/delete-domain-configuration/1/path-parameters.adoc[]

Example:

include::{snippets}/domain-configuration-documentation/delete-domain-configuration/1/http-request.adoc[]


====== Response Fields

This API returns a HTTP 204 NO CONTENT response.

===== Updating A Domain Configuration with ID

A PATCH request will update a domain configuration with a domain configuration ID.

====== Path Parameters

include::{snippets}/domain-configuration-documentation/update-domain-configuration/1/path-parameters.adoc[]

Example:

The example below changes the authenticationApiToken for the domain.

include::{snippets}/domain-configuration-documentation/update-domain-configuration/1/http-request.adoc[]


====== Response

This API returns a HTTP 204 NO CONTENT response.

==== AppUsers

An AppUser contains user information for a specific user. A user should have a username, password,
id, and a domain id. Other properties can be stored in the "properties" property of the user.


==== Creating A User

A POST request will create a user.

===== Request Fields

include::{snippets}/user-management-documentation/create-user/1/request-fields.adoc[]

Example:

include::{snippets}/user-management-documentation/create-user/1/http-request.adoc[]


===== Response Fields

This API returns a HTTP 201 CREATED response with an empty body.


==== Getting A User with an ID

A GET request will get a user with an ID.

===== Path Parameters

include::{snippets}/user-management-documentation/getting-a-user-by-id/1/path-parameters.adoc[]

Example:

include::{snippets}/user-management-documentation/getting-a-user-by-id/1/http-request.adoc[]


===== Response Fields

This API returns an AppUser with these fields:

include::{snippets}/user-management-documentation/getting-a-user-by-id/1/response-fields.adoc[]

Example:

include::{snippets}/user-management-documentation/getting-a-user-by-id/1/http-response.adoc[]

==== Getting All Users Across Domains

A GET request will get all users regardless of domains.

Example:

include::{snippets}/user-management-documentation/getting-all-users/1/http-request.adoc[]


===== Response Fields

This API returns a list of all users with these fields:

include::{snippets}/user-management-documentation/getting-all-users/1/response-fields.adoc[]

Example:

include::{snippets}/user-management-documentation/getting-all-users/1/http-response.adoc[]

==== Removing A User with an ID

A DELETE request will remove a user with an ID.

===== Path Parameters

include::{snippets}/user-management-documentation/deleting-a-user-by-id/1/path-parameters.adoc[]

Example:

include::{snippets}/user-management-documentation/deleting-a-user-by-id/1/http-request.adoc[]


===== Response Fields

This API returns a HTTP 204 NO CONTENT response.

Example:

include::{snippets}/user-management-documentation/deleting-a-user-by-id/1/http-response.adoc[]

==== Updating A User with an ID

A PATCH request will update a user with an ID.

===== Path Parameters

include::{snippets}/user-management-documentation/updating-user-properties/1/path-parameters.adoc[]

Example:

include::{snippets}/user-management-documentation/updating-user-properties/1/http-request.adoc[]


===== Response Fields

This API returns a HTTP 204 NO CONTENT response.

Example:

include::{snippets}/user-management-documentation/updating-user-properties/1/http-response.adoc[]

==== Getting All Users In A Domain

A GET request will get all users in a domain.

===== Request Parameters

include::{snippets}/user-management-documentation/getting-all-users-in-a-domain/1/request-parameters.adoc[]

Example:

include::{snippets}/user-management-documentation/getting-all-users-in-a-domain/1/http-request.adoc[]


===== Response Fields

This API returns a list of all users with these fields:

include::{snippets}/user-management-documentation/getting-all-users-in-a-domain/1/response-fields.adoc[]

Example:

include::{snippets}/user-management-documentation/getting-all-users-in-a-domain/1/http-response.adoc[]

==== Getting A User with a username and domain id

A GET request will get a user with the specified username and domain id.

===== Request Parameters

include::{snippets}/user-management-documentation/getting-a-user-by-username-and-domain/1/request-parameters.adoc[]

Example:

include::{snippets}/user-management-documentation/getting-a-user-by-username-and-domain/1/http-request.adoc[]


===== Response Fields

This API returns an AppUser with these fields:

include::{snippets}/user-management-documentation/getting-a-user-by-username-and-domain/1/response-fields.adoc[]

Example:

include::{snippets}/user-management-documentation/getting-a-user-by-username-and-domain/1/http-response.adoc[]

=== Token Security

Mmadu service uses token based security. Access to API can be done using admin and domain tokens.

==== Admin Token

An admin token is automatically created with an id "admin-token". This token will grant you access
to all resources in the API.

==== Domain Tokens

Domain tokens are created and assigned to a domain configuration. Every domain can have one domain token.
Multiple domains can share a domain token. Domain token grants the API user access to user resources for that domain.

==== Token Encryption

If encryption is enabled, the token values will be encrypted before storing in the database. It uses an AES CBC cipher to
encrypt token values.

Encryption can be enabled by setting the environment property `mmadu.domain.encrypt-keys` to `true`.

Token values are encrypted under the master-key.

===== Changing the Encryption Master Key

To change the encryption master key, set the environment property `mmadu.security.master-key` to the desired value.

==== Generating a Token

A GET request will create a new token and return the token value. If token encryption is enabled, the token value returned is
encrypted.

===== Request

include::{snippets}/token-management-documentation/generate-token/1/http-request.adoc[]

===== Response Fields

This API returns the newly generated token

include::{snippets}/token-management-documentation/generate-token/1/response-fields.adoc[]

Example:

include::{snippets}/token-management-documentation/generate-token/1/http-response.adoc[]

==== Retrieving a Token

A GET request will get a token with the ID.

===== Path Parameters

include::{snippets}/token-management-documentation/retrieve-token/1/path-parameters.adoc[]

Example:

include::{snippets}/token-management-documentation/retrieve-token/1/http-request.adoc[]


===== Response Fields

This API returns an AppUser with these fields:

include::{snippets}/token-management-documentation/retrieve-token/1/response-fields.adoc[]

Example:

include::{snippets}/token-management-documentation/retrieve-token/1/http-response.adoc[]

==== Resetting a Token

A GET request will generate a new token value for the token.

===== Path Parameters

include::{snippets}/token-management-documentation/reset-token/1/path-parameters.adoc[]

Example:

include::{snippets}/token-management-documentation/reset-token/1/http-request.adoc[]


===== Response Fields

This API returns an AppUser with these fields:

include::{snippets}/token-management-documentation/reset-token/1/response-fields.adoc[]

Example:

include::{snippets}/token-management-documentation/reset-token/1/http-response.adoc[]
